using UnityEngine;
using System.Collections;
public class PlayerController : MonoBehaviour
{

    [SerializeField]private float speed = 5.0f;             //our speed
    [SerializeField]private Rigidbody rb;                   //ref the RigidBody
    [SerializeField]private GameObject focalPoint;          //the point we facing we will move in this direction
    [SerializeField]private bool hasPowerUp = false;        //variable to check if we have the power up
    [SerializeField]private float powerUpStrentgh = 15;     //strentgh of our power up attack

    void Start()
    {
        rb = GetComponent<Rigidbody>();
        focalPoint = GameObject.Find("FocalPoint");
    }

    
    void Update()
    {
        float forwardInput = Input.GetAxis("Vertical");
        rb.AddForce(focalPoint.transform.forward  * forwardInput * speed);
    }

    //pick up the power up
    private void OnTriggerEnter(Collider other)
    {
        if (other.CompareTag("PowerUp")) 
        {
            hasPowerUp = true;
            Destroy(other.gameObject);
            StartCoroutine(PowerUpCountdownRoutine()); //call the countdown
        }
    }

    //disbabling the power up after few seconds
    IEnumerator PowerUpCountdownRoutine() 
    {
        yield return new WaitForSeconds(7); //wait for 7 seconds 
        hasPowerUp = false; //power up is disabled
        Debug.Log("Power Up Has Ended");
    }

    //use the power up
    private void OnCollisionEnter(Collision collision)
    {
        if (collision.gameObject.CompareTag("Enemy") && hasPowerUp) 
        {
            Rigidbody enemyRB = collision.gameObject.GetComponent<Rigidbody>();                         //get the enemies rigidbody
            Vector3 awayFromPlayer = (collision.gameObject.transform.position - transform.position);    //move away from the player
            Debug.Log("Collided with" + collision.gameObject.name + "With Powerup set to" + hasPowerUp);
            enemyRB.AddForce(awayFromPlayer * powerUpStrentgh, ForceMode.Impulse);                      //enemy will be sent flying in opposite direction from player when player has power up
        }
    }

}
